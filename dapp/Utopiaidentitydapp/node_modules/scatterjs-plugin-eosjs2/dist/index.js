"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_scatterjsCore=require("scatterjs-core"),proxy=function(a,b){return new Proxy(a,b)},cache={},ScatterEOS=/*#__PURE__*/function(a){function b(){return(0,_classCallCheck2.default)(this,b),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(b).call(this,_scatterjsCore.Blockchains.EOS,_scatterjsCore.PluginTypes.BLOCKCHAIN_SUPPORT))}return(0,_inherits2.default)(b,a),(0,_createClass2.default)(b,[{key:"hookProvider",value:function hookProvider(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return a=_scatterjsCore.Network.fromJson(a),{requiredFields:{},getAvailableKeys:function(){var a=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(){return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,_scatterjsCore.SocketService.sendApiRequest({type:"identityFromPermissions",payload:{}}).then(function(a){return a?a.accounts.filter(function(a){return a.blockchain===_scatterjsCore.Blockchains.EOS}).map(function(a){return a.publicKey}):[]});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop();}},a,this)}));return function getAvailableKeys(){return a.apply(this,arguments)}}(),sign:function(){var c=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function c(d){var e;return _regenerator.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return e=b?b():{},d.serializedTransaction=Buffer.from(d.serializedTransaction).toString("hex"),c.abrupt("return",new Promise(/*#__PURE__*/function(){var b=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function b(c,f){var g;return _regenerator.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:g={transaction:d,blockchain:_scatterjsCore.Blockchains.EOS,network:a,requiredFields:e},_scatterjsCore.SocketService.sendApiRequest({type:"requestSignature",payload:g}).then(function(a){return c(a.signatures)}).catch(function(a){return f(a)});case 2:case"end":return b.stop();}},b,this)}));return function(){return b.apply(this,arguments)}}()));case 3:case"end":return c.stop();}},c,this)}));return function sign(){return c.apply(this,arguments)}}()}}},{key:"signatureProvider",value:function signatureProvider(){var a=this,b=0>=arguments.length?void 0:arguments[0];// Protocol will be deprecated.
return function(b,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(b=_scatterjsCore.Network.fromJson(b),!b.isValid())throw Error.noNetwork();var e={},f=function(){return e},g=a.hookProvider(b,f);// The proxy stands between the eosjs object and scatter.
// This is used to add special functionality like adding `requiredFields` arrays to transactions
return proxy(new c(Object.assign(d,{signatureProvider:g})),{get:function get(a,b){return function(){if("undefined"==typeof a[b])throw new Error("".concat(b," does not exist on the eosjs.Api() object."));for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];var g=d.find(function(a){return a.hasOwnProperty("requiredFields")});return e=g?g.requiredFields:{},a[b].apply(a,d)}}});// Proxy
}}}]),b}(_scatterjsCore.Plugin);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;exports.default=ScatterEOS,"undefined"!=typeof window&&(window.ScatterEOS=ScatterEOS);